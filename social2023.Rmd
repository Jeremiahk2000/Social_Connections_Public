---
title: "social2023"
author: "Kelsey Wu"
date: "3/30/2020"
output:
  html_document: default
  pdf_document: default
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readxl)
library(readr)
library(dplyr)
library(janitor)
library(gt)
library(RColorBrewer)
library(purrr)
library(broom)
library(ggpubr)
library(ggthemes)
```

```{r read_excel_file, echo = FALSE}
freshmen <- read_csv("shiny/data/FINAL_PUBLIC_DATA-4-23-20.csv") %>%
  clean_names() %>%
  mutate(
    id = as.character(id),
    first_id = as.character(first_id),
    second_id = as.character(second_id),
    third_id = as.character(third_id),
    fourth_id = as.character(fourth_id)
  )

myPalette <- brewer.pal(5, "Set2") 
```

# Demographics of Sample

```{r gender_stats, echo = FALSE}

total_students <- 1650

total_respondents <- freshmen %>% nrow()

perc_respondents <- round(total_respondents / total_students * 100, digits = 2)
  
females <- freshmen %>%
  filter(gender == "Female") %>%
  nrow()

males <- freshmen %>%
  filter(gender == "Male") %>%
  nrow()

genderqueer <- freshmen %>%
  filter(gender == "Genderqueer") %>%
  nrow()

gender_prefer_not <- freshmen %>%
  filter(gender == "Prefer not to Say") %>%
  nrow()

perc_female <- round(females / total_respondents * 100, digits = 2)

perc_male <- round(males / total_respondents * 100, digits = 2)

perc_genderqueer <- round(genderqueer / total_respondents * 100, digits = 2)

perc_genderprefernot <- round(gender_prefer_not / total_respondents * 100, digits = 2)

```

## Total Sample Size

A total of `r total_respondents` first-year students answered our survey. Therefore, we had a `r perc_respondents`% response rate from the Class of 2023 (which has a total matriculation of `r total_students`).

## Gender Identity Ratio
`r perc_female`% of respondents were female.
`r perc_male`% of respondents were male
`r perc_genderqueer`% of respondents were genderqueer.
`r perc_genderprefernot`% of respondents preferred not to share their gender.


# Analyzing the Data

```{r compare_satisfaction, echo = FALSE, warning = FALSE, GOOD}

freshmen_satisfaction <- freshmen %>%
  nest(top4 = c(first_id, second_id,
                third_id, fourth_id)) %>%
  select(id, satisfied, top4) %>%
  mutate(satisfaction_lvl = case_when(satisfied == "Very Satisfied" ~ 2,
                                      satisfied == "Satisfied" ~ 1,
                                      satisfied == "Neutral" ~ 0,
                                      satisfied == "Dissatisfied" ~ -1,
                                      satisfied == "Very Dissatisfied" ~ -2))

# List of all names listed in top 4 friends, with repeats

freshmen_top4_list <- unlist(freshmen_satisfaction$top4)

# Calculate overall satisfaction score mean

all_freshmen_satisfaction_mean <- freshmen_satisfaction %>%
  summarize(mean = mean(satisfaction_lvl)) %>%
  pull(mean)

# Create a tibble for comparing satisfaction levels vs. whether or not
# they appear.

compare_satisfaction <- freshmen_satisfaction %>%
  mutate(appear = id %in% freshmen_top4_list) %>%
  group_by(appear) %>%
  summarize(mean_satis = mean(satisfaction_lvl))
```

## How satisfied are you with your social connections?

We asked each respondent how satisfied they were with their social connections. Each respondent was given 5 options: *Very Dissatisfied*, *Dissatisfied*, *Neutral*, *Satisfied*, or *Very Satisfied*.

When coded from -2 to 2 (-2 being *Very Dissatisfied*, 0 being *Neutral*, and 2 being *Very Satisfied*), the mean satisfaction score of all respondents was **`r all_freshmen_satisfaction_mean`**.

### Satisfaction of Harvard's social culture based on whether or not they were listed among other respondents' closest 4 friends

In another part of the survey, we asked respondents to list four first-year students they felt closest to. We wanted to observe the relationship between satisfaction and number of appearances in others' close friend lists.

To do so, we counted how many times each respondent's name appeared in other respondents' top 4 closest friends lists. Then, we correlated this to each respondent's satisfaction level.

#### Bar Plot

First, we compared the satisfaction score mean of respondents who did appear in others' friend lists, and the satisfaction score mean of those who did not.

The horizontal line the graph indicates the mean satisfaction level across all first-years, which was `r all_freshmen_satisfaction_mean`. Since the satisfaction levels were scaled as a 0 if neutral and a 1 if satisfied, our respondents, on average, reported somewhere between neutral and satisfied (leaning satisfied) regarding their social connections.

Respondents who appeared in other respondents' top 4 closest friends lists reported a higher level of satisfaction than respondents who did not appear. In fact, respondents who did not appear at all in other respondents' top 4 closest friends lists reported a below average level of satisfaction, while respondents who did appear reported an above average level of satisfaction.

```{r create_satisfaction_plot, echo = FALSE. included}

# Create ggplot for comparing satisfaction

compare_satisfaction %>%
  ggplot(aes(x = appear, y = mean_satis, fill = appear)) +
  geom_bar(stat = "identity") + 
  guides(fill=FALSE) +
  scale_x_discrete(labels = c("No", "Yes")) +
  labs(
    x = "Did the respondent's name appear in other respondents' top 4 friends lists?",
    y = "Mean Satisfaction Score",
    title = "Comparing mean satisfaction scores of respondents",
    subtitle = "Respondents who appeared in others lists were more satisfied",
    caption = "Very Dissatisfied = -2, Dissatisfied = -1, Neutral = 0, Satisfied = 1, Very Satisfied = 2"
  ) +
  geom_hline(yintercept = all_freshmen_satisfaction_mean) +
  theme_economist()

```

#### Scatter Plot

Then, we plotted number of appearances against mean satisfaction score on a scatter plot.

```{r satisfaction_scatter_plot, echo = FALSE, INCLUDED}

# Rescale satisfaction level for bar plot

freshmen_satisfaction <- freshmen %>%
  nest(top4 = c(first_id, second_id,
                third_id, fourth_id)) %>%
  select(id, satisfied, top4) %>%
  mutate(satisfaction_lvl = case_when(satisfied == "Very Satisfied" ~ 2,
                                      satisfied == "Satisfied" ~ 1,
                                      satisfied == "Neutral" ~ 0,
                                      satisfied == "Dissatisfied" ~ -1,
                                      satisfied == "Very Dissatisfied" ~ -2)) 

# Name search function: counts how many times name appeared in list

name_search <- function(name){
  a <- table(freshmen_top4_list)
  
  unname(a[names(a) == name])
}

# Create tibble with number of appearances column
# Group respondents by number of appearances they had
# Find mean of each group

satisfaction_scatter_tbl <- freshmen_satisfaction %>%
  mutate(appearances = map(id, ~ name_search(.))) %>%
  unnest(appearances)

# Create scatter plot (appearances vs. mean satisfaction level)

satisfaction_scatter_tbl %>%
  ggplot(aes(x = appearances, y = satisfaction_lvl)) +
  geom_point(position = "jitter") +
  geom_smooth(method='lm', formula= y~x) +
  stat_cor(label.x = 5, label.y = 1.5) +
  labs(
    x = "Number of appearances in top 4 friend lists",
    y = "Satisfaction level
    (-2 = Very Dissatisfied, 2 = Very Satisfied)",
    title = "Number of appearances and satisfaction level of
    Harvard social culture",
    subtitle = "Respondents who appeared more frequently reported to be more satisfied",
    caption = "Very Dissatisfied = -2, Dissatisfied = -1, Neutral = 0, Satisfied = 1, Very Satisfied = 2"
  ) + 
  theme_economist()


```

The R value is not statistically significant (p > 0.05), indicating that there is not a very strong relationship between satisfaction level and number of individuals who consider them close friends. This observation suggests that satisfaction about social relationships may not originate from someone else's consideration of you as a close friend — perhaps individuals feel more socially satisfied as a result of other factors. Another way to interpret this absence of a finding is that individuals may be unaware of how close others consider them.

* * * 

## Do students who know more first-years feel more satisfied?

### How many members of the Class of 2023 would you recognize on the street?

We also asked respondents how many members of the 2023 class they would recognize on the street. Below were our results:

```{r street_results, echo = FALSE, included}

freshmen$know_street <- factor(freshmen$know_street,levels = c("0-50", "50-100", "100-250", "250-500", "500-1000", "1000+"))

ggplot(data = freshmen, aes(x = know_street)) + 
  geom_bar(fill = "seagreen4") + 
  labs(
    x = "How many members of the Class of 2023 would you
    recognize on the street?",
    y = "Count",
    title = "Number of freshmen respondents would recognize
    on the street") + 
  theme_economist()


```

We then observed the mean satisfaction levels (measured on a scale from -2 to 2) of each group that stated similar street recognition levels. Below are our results, graphed with the overall average satisfaction level of our entire sample (the black horizontal line).

```{r street_recognition_level_satisfaction, echo = FALSE, good}
freshmen_mod <- freshmen %>%
  
  mutate(satisfaction_lvl = case_when(satisfied == "Very Satisfied" ~ 2,
                                      satisfied == "Satisfied" ~ 1,
                                      satisfied == "Neutral" ~ 0,
                                      satisfied == "Dissatisfied" ~ -1,
                                      satisfied == "Very Dissatisfied" ~ -2)) %>%
  group_by(know_street) %>%
  summarize(satis_know_mean = mean(satisfaction_lvl))

ggplot(data = freshmen_mod, aes(x = know_street, y = satis_know_mean)) +
  geom_bar(stat = "identity", fill = "tomato3") + 
  guides(fill = FALSE) +
  geom_hline(yintercept = all_freshmen_satisfaction_mean) +
  labs(
    x = "Number of freshmen respondents would recognize 
    if encountered on the street", 
    y = "Satisfaction Level",
    title = "Relationship Between Satisfaction and Number of 
    People Recognized",
    caption = "Very Dissatisfied = -2, Dissatisfied = -1, Neutral = 0, Satisfied = 1, Very Satisfied = 1")  + 
  theme_economist()

```

As can be observed, the respondents who could recognize 1000+ first-years on the street reported higher satisfaction level means. The respondents who could recognize 0-50, on the other hand, reported lower than average satisfaction means. This result seems to suggest that the more fellow freshmen the respondent could recognize, the more satisfied they tended to feel about their social experience. This correlation is intuitive.

### How many members of the Class of 2023 would you feel comfortable sitting down with at Annenberg?

We also asked respondents how many freshmen they would feel comfortable sitting down with at Annenberg. Below were our results:

```{r know_in_berg_count, echo = FALSE}

freshmen$know_annenberg <- factor(freshmen$know_annenberg,levels = c("0-50", "50-100", "100-250", "250-500", "500-1000"))

freshmen_mod2 <- freshmen %>%
  filter(know_annenberg != "NA")

ggplot(data = freshmen_mod2, aes(x = know_annenberg)) + 
  geom_bar(fill = "maroon3") + 
  labs(
    x = "Number of freshmen respondents would feel comfortable
    sitting down with at Annenberg",
    y = "Count",
    title = "How many freshmen would you feel comfortable sitting 
    down with at Annenberg?",
    subtitle = "50-100 was the most popular response") + 
  theme_economist()

```

We then observed the mean satisfaction levels (measured on a scale from -2 to 2) of each group that stated similar numbers of students they felt comfortable sitting next to in Annenberg. Below are our results, graphed with the overall average satisfaction level of our entire sample (the black horizontal line).

```{r know_in_berg_satisfaction, echo = FALSE}
freshmen_mod2 <- freshmen %>%
  filter(know_annenberg != "NA") %>%
  mutate(satisfaction_lvl = case_when(satisfied == "Very Satisfied" ~ 2,
                                      satisfied == "Satisfied" ~ 1,
                                      satisfied == "Neutral" ~ 0,
                                      satisfied == "Dissatisfied" ~ -1,
                                      satisfied == "Very Dissatisfied" ~ -2)) %>%
  group_by(know_annenberg) %>%
  summarize(satis_know_mean = mean(satisfaction_lvl))

ggplot(data = freshmen_mod2, aes(x = know_annenberg, y = satis_know_mean)) +
  geom_bar(stat = "identity", fill = "tomato3") + 
  guides(fill = FALSE) +
  geom_hline(yintercept = all_freshmen_satisfaction_mean) +
  labs(
    x = "Number of freshmen respondents would feel comfortable
    sitting next to in Annenberg", 
    y = "Satisfaction Level",
    title = "Relationship Between Satisfaction and Number of 
    People Comfortable Sitting Next to in Annenberg",
    caption = "Very Dissatisfied = -2, Dissatisfied = -1, Neutral = 0, Satisfied = 1, Very Satisfied = 1")  + 
  theme_economist()
```

In this question, students who answered differently did not demonstrate large differences in satisfaction level. Compared to the street recognition level question, mean satisfaction scores of Annenberg-comfortable groups differed less noticeably. This observation suggests that respondents base personal satisfaction more heavily on how many students they recognize, rather than how many students they feel personally close to.

* * *

## Analyzing the "most socially connected" individuals

In our survey, we asked respondents to name the student they perceive to be the "most socially connected" in the Class of 2023. 

### How many times did the "most socially connected" students appear in top 4 friend lists?

To create the graph below, we compiled the top 100 "most socially connected" students. Then, we counted how many times those students appeared in other respondents' top 4 friend lists.

```{r top_socially_connected_appearance_in_top4, echo = FALSE}

# Function takes name input, outputs how many times that name
# appears in the "most socially connected" column.
# In other words, how many respondents thought they were the
# most socially connected person.

well_connected_name_search <- function(name){
  a <- table(freshmen$most_id)
  
  unname(a[names(a) == name])
}

# Create tibble counting how many times each name appears.
# Then, arrange tibble to contain top 100 "socially connected" students

well_connected_top <- freshmen %>%
  count(most_id) %>%
  arrange(desc(n)) %>%
  head(100) %>%
  pull(most_id) %>%
  na.omit()

# Create function that checks for outliers using quantile

is_outlier <- function(x) {
    return(x < quantile(x, 0.25) - 1.5 * IQR(x) | x > quantile(x, 0.75) + 1.5 * IQR(x))
}

# Create tibble that shows the top 100 "socially connected" students.
# The tibble has 3 columns:
# name column: names of top 100 "socially connected" students
# appearances_in_well_connected column: how many respondents thought this student was the most well connected
# appearances_in_top4 column: how many respondents listed this student as one of their top 4 friends

well_connected_top_appearances <- tibble(
  id = as.character(well_connected_top),
  appearances_in_top4 = map(id, ~ name_search(.)),
  appearances_in_well_connected = map(id, ~ well_connected_name_search(.))) %>%
  unnest(cols = c(appearances_in_top4, appearances_in_well_connected)) %>%
  mutate(outlierconn = is_outlier(appearances_in_well_connected)) %>%
  mutate(outliertop4 = is_outlier(appearances_in_top4)) %>%
  filter(outlierconn == FALSE & outliertop4 == FALSE)

# Create ggplot

well_connected_top_appearances %>%
  ggplot(aes(x = appearances_in_well_connected, y = appearances_in_top4)) +
  geom_point() +
  
  # Add line of best fit
  
  geom_smooth(method='lm', formula= y~x, color = "skyblue3") +
  
  geom_jitter() +
  
  # Add correlation labels
  
  stat_cor(label.x = 2, label.y = 3.5) +
  labs(
    x = "Number of appearances in 'most socially connected' question",
    y = "Number of appearances in top 4 friend lists",
    title = "Appearances of 'most socially connected' people in top 4 friend lists",
    subtitle = "Most 'socially connected' does not strongly correlate with 'closeness' with the most people"
  ) + theme_economist()

```

As seen in the graph above, the number of times someone was named "most socially connected" had a very weak positive correlation with the number of times that person was named a close friend. This observation is interesting — it indicates that individuals who are considered socially connected may not always be the "closest" to the most people. Having a general impression of someone as a socially connected person does not mean the most people considers that person a close friend.

### Comparing satisfaction levels of top 100 "most socially connected" to top 100 number of appearances in friend lists

```{r socially_connected_satisfaction, echo = FALSE, message = FALSE, warning = FALSE, PROBLEM}

top_well_connected_satisfaction <- inner_join(well_connected_top_appearances, freshmen, by = "id") %>%
  mutate(satisfaction_lvl = case_when(satisfied == "Very Satisfied" ~ 2,
                                      satisfied == "Satisfied" ~ 1,
                                      satisfied == "Neutral" ~ 0,
                                      satisfied == "Dissatisfied" ~ -1,
                                      satisfied == "Very Dissatisfied" ~ -2)) %>%
  select(id, appearances_in_top4, appearances_in_well_connected, satisfaction_lvl)

top_top4appearance_satisfaction <- freshmen %>%
  mutate(appearances = map(id, ~ name_search(.))) %>%
  unnest(cols = c(appearances)) %>%
  arrange(desc(appearances)) %>%
  head(100) %>%
  mutate(satisfaction_lvl = case_when(satisfied == "Very Satisfied" ~ 2,
                                      satisfied == "Satisfied" ~ 1,
                                      satisfied == "Neutral" ~ 0,
                                      satisfied == "Dissatisfied" ~ -1,
                                      satisfied == "Very Dissatisfied" ~ -2)) %>%
  select(id, appearances, satisfaction_lvl)

top_well_connected_satisfaction_average <- top_well_connected_satisfaction %>%
  summarize(social_connected_mean = mean(satisfaction_lvl)) %>%
  pull(social_connected_mean)

top_top4appearance_satisfaction_average <- top_top4appearance_satisfaction %>%
  summarize(top4appear_mean = mean(satisfaction_lvl)) %>%
  pull(top4appear_mean)

```

Next, we compared the mean satisfaction scores of the top 100 students who appeared the most in the socially connected column to the top 100 students who appeared the most in other respondents' friend lists.

* The overall satisfaction score mean of our entire sample: `r all_freshmen_satisfaction_mean`.
* The satisfaction score mean of top 100 "most socially connected students": `r top_well_connected_satisfaction_average`.
* The satisfaction score mean of top 100 students with most appearances in friend lists: `r  top_top4appearance_satisfaction_average`.

Students who are considered more socially connected and students who appeared most frequently in others' friend lists had higher-than-average mean satisfaction scores. Between the two populations, however, the difference was not significant. 

```{r}
freshmen <- read_csv("shiny/data/FINAL_PUBLIC_DATA-4-23-20.csv") %>%
        clean_names()
      
      total_respondents <- freshmen %>% nrow()
        
      dorm_plot <- freshmen %>%
        select(dorm) %>%
        count(dorm) %>%
        mutate(perc_dorm = round(n / total_respondents*100, digits = 2))
      
      dorm_plot %>%
        ggplot(aes(y = n, x = dorm, fill = dorm)) +
        geom_col() + 
        geom_text(aes(label = paste0(perc_dorm, "%")), size = 4) +
        coord_flip() + 
        theme_economist() +
        labs(
          x = "",
          y = "Number of Respondents",
          title = "Dorm Distribution in Respondent Sample") + 
        theme(legend.position = "none")
```

